(this.webpackJsonpcascade=this.webpackJsonpcascade||[]).push([[0],{27:function(e,t,n){e.exports=n(70)},32:function(e,t,n){},57:function(e,t){},59:function(e,t){},67:function(e,t,n){},68:function(e,t,n){},69:function(e,t,n){},70:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(24),c=n.n(r),i=(n(32),n(1)),s=n(26),u=n(10),l=n(6),f=n(25),m=n.n(f);function d(e,t){return new m.a({initiator:e,stream:t,trickle:!1})}function E(e,t){e.send(JSON.stringify(t))}function b(e,t,n){var a=t.initiator,o=t.myStream;e.on("data",(function(t){var r=JSON.parse(t.toString());a?function(e){var t=e.action,a=e.forId,o=e.fromId;console.log("relaying ".concat(t," for ").concat(a," from ").concat(o)),n({type:"PEER_SEND",id:a,data:e})}(r):function(t){var a=t.action,r=t.forId,c=t.fromId,i=t.signal;if(console.log("receiving ".concat(a," from ").concat(c)),"initiate"===a||"offer"===a){var s="initiate"===a,u=d(s,o);u.on("signal",(function(t){var n=s?"offer":"answer";console.log("sending ".concat(n," for ").concat(c)),["offer","answer"].includes(t.type)?E(e,{action:n,forId:c,fromId:r,signal:t}):console.log("not sending unknown signal type")})),u.on("stream",(function(e){n({type:"STREAMS_ADD",id:c,stream:e})})),s||u.signal(i),n({type:"PEERS_ADD",id:c,peer:u})}else"answer"===a&&(console.log("signaling answer"),n({type:"PEER_SIGNAL",id:c,signal:i}))}(r)}))}var v={initiator:"#init"===window.location.hash,myStream:null,peers:{},streams:{}};function g(e,t){console.log("ACTION",t);var n=e.peers,a=e.streams;switch(t.type){case"MY_STREAM_SET":return Object(l.a)({},e,{myStream:t.stream});case"PEER_RELAY":return function(e,t){console.log("adding peer ".concat(t)),Object.entries(e).filter((function(e){var n=Object(i.a)(e,2),a=n[0];return n[1].connected&&a!==t})).forEach((function(e){var n=Object(i.a)(e,2),a=n[0],o=n[1];console.log("sending initiate action to peer ".concat(a," for new peer ").concat(t)),E(o,{action:"initiate",forId:a,fromId:t})}))}(n,t.id),e;case"PEER_SEND":var o=t.id,r=t.data;return E(n[o],r),e;case"PEER_SIGNAL":var c=t.id,s=t.signal;return n[c].signal(s),e;case"PEERS_ADD":return Object(l.a)({},e,{peers:Object(l.a)({},n,Object(u.a)({},t.id,t.peer))});case"STREAMS_ADD":return Object(l.a)({},e,{streams:Object(l.a)({},a,Object(u.a)({},t.id,t.stream))});default:return e}}var O=Object(a.createContext)(v),p=function(e){var t=e.children,n=Object(a.useReducer)(g,v),r=Object(i.a)(n,2),c=r[0],s=r[1];return o.a.createElement(O.Provider,{value:[c,s]},t)},y=function(){var e=Object(a.useContext)(O),t=Object(i.a)(e,2),n=t[0],r=t[1],c=n.initiator,s=n.myStream,u=Object(a.useState)(!1),l=Object(i.a)(u,2),f=l[0],m=l[1],E=Object(a.useState)(""),v=Object(i.a)(E,2),g=v[0],p=v[1],y=Object(a.useState)(""),j=Object(i.a)(y,2),h=j[0],S=j[1],w=Object(a.useState)(null),k=Object(i.a)(w,2),R=k[0],_=k[1];if(Object(a.useEffect)((function(){var e=d(c,s);e.on("signal",(function(e){p(JSON.stringify(e))})),e.on("connect",(function(){m(!0),c&&r({type:"PEER_RELAY",id:e._id})})),e.on("stream",(function(t){r({type:"STREAMS_ADD",id:e._id,stream:t})})),b(e,n,r),r({type:"PEERS_ADD",id:e._id,peer:e}),_(e)}),[]),f)return null;var A=c?"Send this connection info to your friend":"Reply to your friend with your connection info",D=c?"Your friend should reply with their own connection info, paste it here":"Paste the connection info sent from your friend here",P=o.a.createElement("label",{key:"my-connection"},A,":",o.a.createElement("textarea",{readOnly:!0,value:g})),I=o.a.createElement("label",{key:"their-connection"},D,":",o.a.createElement("textarea",{onChange:function(e){return S(e.target.value)},value:h})),C=o.a.createElement("input",{key:"connect",type:"submit",value:"Connect!"}),N=[];return c?g?N.push(P,I,C):N.push("Generating connection info..."):(N.push(I,C),g&&N.push(P)),o.a.createElement("form",{onSubmit:function(e){e.preventDefault(),R.signal(JSON.parse(h))}},N)},j=(n(67),function(){var e=Object(a.useContext)(O),t=Object(i.a)(e,1)[0].initiator,n=Object(a.useState)([o.a.createElement(y,{key:0})]),r=Object(i.a)(n,2),c=r[0],u=r[1];return o.a.createElement("div",{className:"pending-connections"},c,t&&o.a.createElement("button",{onClick:function(){u([].concat(Object(s.a)(c),[o.a.createElement(y,{key:c.length})]))}},"Invite another friend"))}),h=function(){var e=Object(a.useContext)(O),t=Object(i.a)(e,2)[1];return o.a.createElement("section",null,o.a.createElement("div",null,"Welcome. Let's make the connections."),o.a.createElement("div",null,"First, let's enable your audio and video. So make yourself presentable. Put some pants on (or take them off if it's that kinda thing). Put on your makeup and/or mask. Enable your autotune whatnots."),o.a.createElement("button",{onClick:function(){navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(e){t({type:"MY_STREAM_SET",stream:e})}))}},"Let's go!"))},S=function(e){var t=e.stream,n=Object(a.useCallback)((function(e){e&&("srcObject"in e?e.srcObject=t:e.src=URL.createObjectURL(t))}),[t]);return t&&o.a.createElement("video",{autoPlay:!0,ref:n})},w=(n(68),function(){var e=Object(a.useContext)(O),t=Object(i.a)(e,1)[0];console.log("STATE",t);var n=t.myStream,r=t.streams;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"videos"},n?o.a.createElement(S,{stream:n}):o.a.createElement(h,null),Object.entries(r).map((function(e){var t=Object(i.a)(e,2),n=t[0],a=t[1];return o.a.createElement(S,{key:n,stream:a})}))),n&&o.a.createElement(j,null))}),k=(n(69),function(){return o.a.createElement(p,null,o.a.createElement(w,null))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(o.a.createElement(k,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[27,1,2]]]);
//# sourceMappingURL=main.de670e4d.chunk.js.map