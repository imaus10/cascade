(this.webpackJsonpcascade=this.webpackJsonpcascade||[]).push([[0],{27:function(e,t,n){e.exports=n(70)},32:function(e,t,n){},57:function(e,t){},59:function(e,t){},67:function(e,t,n){},68:function(e,t,n){},69:function(e,t,n){},70:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(24),c=n.n(o),i=(n(32),n(1)),s=n(26),u=n(10),l=n(6),f=n(25),m=n.n(f);function d(e,t){return new m.a({initiator:e,stream:t,trickle:!1})}function E(e,t){e.send(JSON.stringify(t))}function b(e,t,n){var a=t.initiator,r=t.myStream;e.on("data",(function(t){var o=JSON.parse(t.toString());a?function(e){var t=e.action,a=e.forId,r=e.fromId;console.log("relaying ".concat(t," for ").concat(a," from ").concat(r)),n({type:"PEER_SEND",id:a,data:e})}(o):function(t){var a=t.action,o=t.forId,c=t.fromId,i=t.signal;if(console.log("receiving ".concat(a," from ").concat(c)),"initiate"===a||"offer"===a){var s="initiate"===a,u=d(s,r);u.on("signal",(function(t){var n=s?"offer":"answer";console.log("sending ".concat(n," for ").concat(c)),["offer","answer"].includes(t.type)?E(e,{action:n,forId:c,fromId:o,signal:t}):console.log("not sending unknown signal type")})),u.on("stream",(function(e){n({type:"STREAMS_ADD",id:c,stream:e})})),s||u.signal(i),n({type:"PEERS_ADD",id:c,peer:u})}else"answer"===a&&(console.log("signaling answer"),n({type:"PEER_SIGNAL",id:c,signal:i}))}(o)}))}var v={initiator:"#init"===window.location.hash,myStream:null,peers:{},streams:{}};function O(e,t){console.log("ACTION",t);var n=e.peers,a=e.streams;switch(t.type){case"MY_STREAM_SET":return Object(l.a)({},e,{myStream:t.stream});case"PEER_RELAY":return function(e,t){console.log("adding peer ".concat(t)),Object.entries(e).filter((function(e){var n=Object(i.a)(e,2),a=n[0];return n[1].connected&&a!==t})).forEach((function(e){var n=Object(i.a)(e,2),a=n[0],r=n[1];console.log("sending initiate action to peer ".concat(a," for new peer ").concat(t)),E(r,{action:"initiate",forId:a,fromId:t})}))}(n,t.id),e;case"PEER_SEND":var r=t.id,o=t.data;return E(n[r],o),e;case"PEER_SIGNAL":var c=t.id,s=t.signal;return n[c].signal(s),e;case"PEERS_ADD":return Object(l.a)({},e,{peers:Object(l.a)({},n,Object(u.a)({},t.id,t.peer))});case"STREAMS_ADD":return Object(l.a)({},e,{streams:Object(l.a)({},a,Object(u.a)({},t.id,t.stream))});default:return e}}var g=Object(a.createContext)(v),p=function(e){var t=e.children,n=Object(a.useReducer)(O,v),o=Object(i.a)(n,2),c=o[0],s=o[1];return r.a.createElement(g.Provider,{value:[c,s]},t)},j=function(){var e=Object(a.useContext)(g),t=Object(i.a)(e,2),n=t[0],o=t[1],c=n.initiator,s=n.myStream,u=Object(a.useState)(!1),l=Object(i.a)(u,2),f=l[0],m=l[1],E=Object(a.useState)(""),v=Object(i.a)(E,2),O=v[0],p=v[1],j=Object(a.useState)(""),y=Object(i.a)(j,2),S=y[0],h=y[1],w=Object(a.useState)(null),R=Object(i.a)(w,2),_=R[0],A=R[1];if(Object(a.useEffect)((function(){var e=d(c,s);e.on("signal",(function(e){p(JSON.stringify(e))})),e.on("connect",(function(){m(!0),c&&o({type:"PEER_RELAY",id:e._id})})),e.on("stream",(function(t){o({type:"STREAMS_ADD",id:e._id,stream:t})})),e.on("error",(function(e){console.error("Peer error:",e)})),b(e,n,o),o({type:"PEERS_ADD",id:e._id,peer:e}),A(e)}),[]),f)return null;var k=c?"Send this connection info to your friend":"Reply to your friend with your connection info",D=c?"Your friend should reply with their own connection info, paste it here":"Paste the connection info sent from your friend here",I=r.a.createElement("label",{key:"my-connection"},k,":",r.a.createElement("textarea",{readOnly:!0,value:O})),P=r.a.createElement("label",{key:"their-connection"},D,":",r.a.createElement("textarea",{onChange:function(e){return h(e.target.value)},value:S})),C=r.a.createElement("input",{key:"connect",type:"submit",value:"Connect!"}),N=[];return c?O?N.push(I,P,C):N.push("Generating connection info..."):(N.push(P,C),O&&N.push(I)),r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),_.signal(JSON.parse(S))}},N)},y=(n(67),function(){var e=Object(a.useContext)(g),t=Object(i.a)(e,1)[0].initiator,n=Object(a.useState)([r.a.createElement(j,{key:0})]),o=Object(i.a)(n,2),c=o[0],u=o[1];return r.a.createElement("div",{className:"pending-connections"},c,t&&r.a.createElement("button",{onClick:function(){u([].concat(Object(s.a)(c),[r.a.createElement(j,{key:c.length})]))}},"Invite another friend"))}),S=function(){var e=Object(a.useContext)(g),t=Object(i.a)(e,2)[1];return r.a.createElement("section",null,r.a.createElement("div",null,"Welcome. Let's make the connections."),r.a.createElement("div",null,"First, enable your audio and video."),r.a.createElement("button",{onClick:function(){navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(e){t({type:"MY_STREAM_SET",stream:e})}))}},"Let's go!"))},h=function(e){var t=e.muted,n=void 0!==t&&t,o=e.stream,c=Object(a.useCallback)((function(e){e&&("srcObject"in e?e.srcObject=o:e.src=URL.createObjectURL(o))}),[o]);return o&&r.a.createElement("video",{autoPlay:!0,muted:n,ref:c})},w=(n(68),function(){var e=Object(a.useContext)(g),t=Object(i.a)(e,1)[0];console.log("STATE",t);var n=t.myStream,o=t.streams;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"videos"},n?r.a.createElement(h,{muted:!0,stream:n}):r.a.createElement(S,null),Object.entries(o).map((function(e){var t=Object(i.a)(e,2),n=t[0],a=t[1];return r.a.createElement(h,{key:n,stream:a})}))),n&&r.a.createElement(y,null))}),R=(n(69),function(){return r.a.createElement(p,null,r.a.createElement(w,null))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(R,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[27,1,2]]]);
//# sourceMappingURL=main.5c5c15db.chunk.js.map